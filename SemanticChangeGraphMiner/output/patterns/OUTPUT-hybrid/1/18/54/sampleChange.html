<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3>2ecabde500dc64cf87e362f5b8edb1fdb139b246,deeplearning4j/deeplearning4j-core/src/test/java/org/deeplearning4j/nn/layers/recurrent/TestLastTimeStepLayer.java,TestLastTimeStepLayer,testLastTimeStepVertex,#,48
</h3><h3>Before Change</h3><pre><code class='java'>
        Layer l = graph.getLayer("lastTS");
        INDArray in = Nd4j.rand(new int[]{3, 5, 6});
        INDArray outUnderlying = ((LastTimeStepLayer)l).getUnderlying().activate(in, false, LayerWorkspaceMgr.noWorkspaces());
        INDArray expOut = outUnderlying.<a id="change">get(</a>NDArrayIndex.all(), NDArrayIndex.all(), NDArrayIndex.point(5)<a id="change">)</a>;


        //Forward pass:</code></pre><h3>After Change</h3><pre><code class='java'>
        Nd4j.getRandom().setSeed(12345);
        Layer l = graph.getLayer("lastTS");
        INDArray in;
        if (<a id="change">rnnDataFormat</a><a id="change"> == RNNFormat</a><a id="change">.NCW</a>){
            in = Nd4j.rand(3, 5, 6);
        }
        else{
            in = Nd4j.rand(3, 6, 5);
        }
        INDArray outUnderlying = ((LastTimeStepLayer)l).getUnderlying().activate(in, false, LayerWorkspaceMgr.noWorkspaces());
        INDArray expOut;
        <a id="change">if (</a><a id="change">rnnDataFormat</a><a id="change"> == RNNFormat.NCW</a><a id="change">)</a>{
            expOut = outUnderlying.<a id="change">get(</a>NDArrayIndex.all(), NDArrayIndex.all(), NDArrayIndex.point(5)<a id="change">)</a>;
        }
        else{
            expOut = <a id="change">outUnderlying</a>.<a id="change">get(</a>NDArrayIndex.<a id="change">all()</a>, NDArrayIndex.<a id="change">point(</a>5<a id="change">)</a>, NDArrayIndex.<a id="change">all()</a><a id="change">)</a>;
        }



        //Forward pass:
        INDArray outFwd = l.activate(in, false, LayerWorkspaceMgr.noWorkspaces());
        assertEquals(expOut, outFwd);

        //Second: test with input mask array
        INDArray inMask = Nd4j.zeros(3, 6);
        inMask.putRow(0, Nd4j.create(new double[]{1, 1, 1, 0, 0, 0}));
        inMask.putRow(1, Nd4j.create(new double[]{1, 1, 1, 1, 0, 0}));
        inMask.putRow(2, Nd4j.create(new double[]{1, 1, 1, 1, 1, 0}));
        graph.setLayerMaskArrays(new INDArray[]{inMask}, null);

        expOut = Nd4j.zeros(3, 6);
        if (<a id="change">rnnDataFormat</a><a id="change"> == RNNFormat</a><a id="change">.NCW</a>){
            expOut.putRow(0, outUnderlying.get(NDArrayIndex.point(0), NDArrayIndex.all(), NDArrayIndex.point(2)));
            expOut.putRow(1, outUnderlying.get(NDArrayIndex.point(1), NDArrayIndex.all(), NDArrayIndex.point(3)));
            expOut.putRow(2, outUnderlying.get(NDArrayIndex.point(2), NDArrayIndex.all(), NDArrayIndex.point(4)));</code></pre>